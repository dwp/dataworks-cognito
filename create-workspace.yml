---
platform: linux
image_resource:
  type: docker-image
  source:
    repository: hashicorp/terraform
    tag: 0.12.31
params:
  TF_INPUT: false
  WORKSPACE: ((workspace))
inputs:
  - name: repo
run:
  path: sh
  args:
    - -exc
    - |
      cd deploy
      echo "Creating workspace $WORKSPACE"
      terraform init
      terraform workspace new $WORKSPACE
      terraform apply -auto-approve
  dir: repo
